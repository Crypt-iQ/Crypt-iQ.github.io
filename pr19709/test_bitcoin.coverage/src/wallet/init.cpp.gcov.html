<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - test_bitcoin_coverage.info - src/wallet/init.cpp</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">src/wallet</a> - init.cpp<span style="font-size: 80%;"> (source / <a href="init.cpp.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">test_bitcoin_coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">49</td>
            <td class="headerCovTableEntry">65</td>
            <td class="headerCovTableEntryMed">75.4 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2020-08-14 02:46:54</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">6</td>
            <td class="headerCovTableEntry">8</td>
            <td class="headerCovTableEntryMed">75.0 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : // Copyright (c) 2009-2010 Satoshi Nakamoto</a>
<span class="lineNum">       2 </span>            : // Copyright (c) 2009-2020 The Bitcoin Core developers
<span class="lineNum">       3 </span>            : // Distributed under the MIT software license, see the accompanying
<span class="lineNum">       4 </span>            : // file COPYING or http://www.opensource.org/licenses/mit-license.php.
<span class="lineNum">       5 </span>            : 
<span class="lineNum">       6 </span>            : #include &lt;init.h&gt;
<span class="lineNum">       7 </span>            : #include &lt;interfaces/chain.h&gt;
<span class="lineNum">       8 </span>            : #include &lt;net.h&gt;
<span class="lineNum">       9 </span>            : #include &lt;node/context.h&gt;
<span class="lineNum">      10 </span>            : #include &lt;node/ui_interface.h&gt;
<span class="lineNum">      11 </span>            : #include &lt;outputtype.h&gt;
<span class="lineNum">      12 </span>            : #include &lt;util/check.h&gt;
<span class="lineNum">      13 </span>            : #include &lt;util/moneystr.h&gt;
<span class="lineNum">      14 </span>            : #include &lt;util/system.h&gt;
<span class="lineNum">      15 </span>            : #include &lt;util/translation.h&gt;
<span class="lineNum">      16 </span>            : #include &lt;wallet/coincontrol.h&gt;
<span class="lineNum">      17 </span>            : #include &lt;wallet/wallet.h&gt;
<a name="18"><span class="lineNum">      18 </span>            : #include &lt;walletinitinterface.h&gt;</a>
<span class="lineNum">      19 </span>            : 
<span class="lineNum">      20 </span><span class="lineCov">         89 : class WalletInit : public WalletInitInterface</span>
<span class="lineNum">      21 </span>            : {
<a name="22"><span class="lineNum">      22 </span>            : public:</a>
<span class="lineNum">      23 </span>            :     //! Was the wallet component compiled in.
<span class="lineNum">      24 </span><span class="lineNoCov">          0 :     bool HasWalletSupport() const override {return true;}</span>
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            :     //! Return the wallets help message.
<span class="lineNum">      27 </span>            :     void AddWalletOptions(ArgsManager&amp; argsman) const override;
<span class="lineNum">      28 </span>            : 
<span class="lineNum">      29 </span>            :     //! Wallets parameter interaction
<span class="lineNum">      30 </span>            :     bool ParameterInteraction() const override;
<span class="lineNum">      31 </span>            : 
<span class="lineNum">      32 </span>            :     //! Add wallets that should be opened to list of chain clients.
<span class="lineNum">      33 </span>            :     void Construct(NodeContext&amp; node) const override;
<a name="34"><span class="lineNum">      34 </span>            : };</a>
<span class="lineNum">      35 </span>            : 
<a name="36"><span class="lineNum">      36 </span><span class="lineCov">         89 : const WalletInitInterface&amp; g_wallet_init_interface = WalletInit();</span></a>
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span><span class="lineCov">        417 : void WalletInit::AddWalletOptions(ArgsManager&amp; argsman) const</span>
<span class="lineNum">      39 </span>            : {
<span class="lineNum">      40 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-addresstype&quot;, strprintf(&quot;What type of addresses to use (\&quot;legacy\&quot;, \&quot;p2sh-segwit\&quot;, or \&quot;bech32\&quot;, default: \&quot;%s\&quot;)&quot;, FormatOutputType(DEFAULT_ADDRESS_TYPE)), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      41 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-avoidpartialspends&quot;, strprintf(&quot;Group outputs by address, selecting all or none, instead of selecting on a per-output basis. Privacy is improved as an address is only used once (unless someone sends to it after spending from it), but may result in slightly higher fees as suboptimal coin selection may result due to the added limitation (default: %u (always enabled for wallets with \&quot;avoid_reuse\&quot; enabled))&quot;, DEFAULT_AVOIDPARTIALSPENDS), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      42 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-changetype&quot;, &quot;What type of change to use (\&quot;legacy\&quot;, \&quot;p2sh-segwit\&quot;, or \&quot;bech32\&quot;). Default is same as -addresstype, except when -addresstype=p2sh-segwit a native segwit output is used when sending to a native segwit address)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      43 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-disablewallet&quot;, &quot;Do not load the wallet and disable wallet RPC calls&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      44 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-discardfee=&lt;amt&gt;&quot;, strprintf(&quot;The fee rate (in %s/kB) that indicates your tolerance for discarding change by adding it to the fee (default: %s). &quot;</span>
<span class="lineNum">      45 </span>            :                                                                 &quot;Note: An output is discarded if it is dust at this rate, but we will always discard up to the dust relay fee and a discard fee above that is limited by the fee estimate for the longest target&quot;,
<span class="lineNum">      46 </span><span class="lineCov">        834 :                                                               CURRENCY_UNIT, FormatMoney(DEFAULT_DISCARD_FEE)), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      47 </span>            : 
<span class="lineNum">      48 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-fallbackfee=&lt;amt&gt;&quot;, strprintf(&quot;A fee rate (in %s/kB) that will be used when fee estimation has insufficient data. 0 to entirely disable the fallbackfee feature. (default: %s)&quot;,</span>
<span class="lineNum">      49 </span><span class="lineCov">        834 :                                                                CURRENCY_UNIT, FormatMoney(DEFAULT_FALLBACK_FEE)), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      50 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-keypool=&lt;n&gt;&quot;, strprintf(&quot;Set key pool size to &lt;n&gt; (default: %u). Warning: Smaller sizes may increase the risk of losing funds when restoring from an old backup, if none of the addresses in the original keypool have been used.&quot;, DEFAULT_KEYPOOL_SIZE), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      51 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-maxtxfee=&lt;amt&gt;&quot;, strprintf(&quot;Maximum total fees (in %s) to use in a single wallet transaction; setting this too low may abort large transactions (default: %s)&quot;,</span>
<span class="lineNum">      52 </span><span class="lineCov">        834 :         CURRENCY_UNIT, FormatMoney(DEFAULT_TRANSACTION_MAXFEE)), ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);</span>
<span class="lineNum">      53 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-mintxfee=&lt;amt&gt;&quot;, strprintf(&quot;Fees (in %s/kB) smaller than this are considered zero fee for transaction creation (default: %s)&quot;,</span>
<span class="lineNum">      54 </span><span class="lineCov">        834 :                                                             CURRENCY_UNIT, FormatMoney(DEFAULT_TRANSACTION_MINFEE)), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      55 </span><span class="lineCov">        834 :     argsman.AddArg(&quot;-paytxfee=&lt;amt&gt;&quot;, strprintf(&quot;Fee (in %s/kB) to add to transactions you send (default: %s)&quot;,</span>
<span class="lineNum">      56 </span><span class="lineCov">        834 :                                                             CURRENCY_UNIT, FormatMoney(CFeeRate{DEFAULT_PAY_TX_FEE}.GetFeePerK())), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      57 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-rescan&quot;, &quot;Rescan the block chain for missing wallet transactions on startup&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      58 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-spendzeroconfchange&quot;, strprintf(&quot;Spend unconfirmed change when sending transactions (default: %u)&quot;, DEFAULT_SPEND_ZEROCONF_CHANGE), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      59 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-txconfirmtarget=&lt;n&gt;&quot;, strprintf(&quot;If paytxfee is not set, include enough fee so transactions begin confirmation on average within n blocks (default: %u)&quot;, DEFAULT_TX_CONFIRM_TARGET), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      60 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-wallet=&lt;path&gt;&quot;, &quot;Specify wallet database path. Can be specified multiple times to load multiple wallets. Path is interpreted relative to &lt;walletdir&gt; if it is not absolute, and will be created if it does not exist (as a directory containing a wallet.dat file and log files). For backwards compatibility this will also accept names of existing data files in &lt;walletdir&gt;.)&quot;, ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::WALLET);</span>
<span class="lineNum">      61 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-walletbroadcast&quot;,  strprintf(&quot;Make the wallet broadcast transactions (default: %u)&quot;, DEFAULT_WALLETBROADCAST), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      62 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-walletdir=&lt;dir&gt;&quot;, &quot;Specify directory to hold wallets (default: &lt;datadir&gt;/wallets if it exists, otherwise &lt;datadir&gt;)&quot;, ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::WALLET);</span>
<span class="lineNum">      63 </span>            : #if HAVE_SYSTEM
<span class="lineNum">      64 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-walletnotify=&lt;cmd&gt;&quot;, &quot;Execute command when a wallet transaction changes. %s in cmd is replaced by TxID and %w is replaced by wallet name. %w is not currently implemented on windows. On systems where %w is supported, it should NOT be quoted because this would break shell escaping used to invoke the command.&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      65 </span>            : #endif
<span class="lineNum">      66 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-walletrbf&quot;, strprintf(&quot;Send transactions with full-RBF opt-in enabled (RPC only, default: %u)&quot;, DEFAULT_WALLET_RBF), ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      67 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-zapwallettxes=&lt;mode&gt;&quot;, &quot;Delete all wallet transactions and only recover those parts of the blockchain through -rescan on startup&quot;</span>
<span class="lineNum">      68 </span><span class="lineCov">        417 :                                &quot; (1 = keep tx meta data e.g. payment request information, 2 = drop tx meta data)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::WALLET);</span>
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-dblogsize=&lt;n&gt;&quot;, strprintf(&quot;Flush wallet database activity from memory to disk log every &lt;n&gt; megabytes (default: %u)&quot;, DEFAULT_WALLET_DBLOGSIZE), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);</span>
<span class="lineNum">      71 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-flushwallet&quot;, strprintf(&quot;Run a thread to flush wallet periodically (default: %u)&quot;, DEFAULT_FLUSHWALLET), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);</span>
<span class="lineNum">      72 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-privdb&quot;, strprintf(&quot;Sets the DB_PRIVATE flag in the wallet db environment (default: %u)&quot;, DEFAULT_WALLET_PRIVDB), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);</span>
<span class="lineNum">      73 </span><span class="lineCov">        417 :     argsman.AddArg(&quot;-walletrejectlongchains&quot;, strprintf(&quot;Wallet will not create transactions that violate mempool chain limits (default: %u)&quot;, DEFAULT_WALLET_REJECT_LONG_CHAINS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);</span>
<a name="74"><span class="lineNum">      74 </span><span class="lineCov">        417 : }</span></a>
<span class="lineNum">      75 </span>            : 
<span class="lineNum">      76 </span><span class="lineCov">        417 : bool WalletInit::ParameterInteraction() const</span>
<span class="lineNum">      77 </span>            : {
<span class="lineNum">      78 </span><span class="lineCov">        417 :     if (gArgs.GetBoolArg(&quot;-disablewallet&quot;, DEFAULT_DISABLE_WALLET)) {</span>
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :         for (const std::string&amp; wallet : gArgs.GetArgs(&quot;-wallet&quot;)) {</span>
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :             LogPrintf(&quot;%s: parameter interaction: -disablewallet -&gt; ignoring -wallet=%s\n&quot;, __func__, wallet);</span>
<span class="lineNum">      81 </span>            :         }
<span class="lineNum">      82 </span>            : 
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :         return true;</span>
<span class="lineNum">      84 </span>            :     }
<span class="lineNum">      85 </span>            : 
<span class="lineNum">      86 </span><span class="lineCov">        417 :     const bool is_multiwallet = gArgs.GetArgs(&quot;-wallet&quot;).size() &gt; 1;</span>
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span><span class="lineCov">        417 :     if (gArgs.GetBoolArg(&quot;-blocksonly&quot;, DEFAULT_BLOCKSONLY) &amp;&amp; gArgs.SoftSetBoolArg(&quot;-walletbroadcast&quot;, false)) {</span>
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :         LogPrintf(&quot;%s: parameter interaction: -blocksonly=1 -&gt; setting -walletbroadcast=0\n&quot;, __func__);</span>
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">      91 </span>            : 
<span class="lineNum">      92 </span><span class="lineCov">        417 :     bool zapwallettxes = gArgs.GetBoolArg(&quot;-zapwallettxes&quot;, false);</span>
<span class="lineNum">      93 </span>            :     // -zapwallettxes implies dropping the mempool on startup
<span class="lineNum">      94 </span><span class="lineCov">        417 :     if (zapwallettxes &amp;&amp; gArgs.SoftSetBoolArg(&quot;-persistmempool&quot;, false)) {</span>
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :         LogPrintf(&quot;%s: parameter interaction: -zapwallettxes enabled -&gt; setting -persistmempool=0\n&quot;, __func__);</span>
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">      97 </span>            : 
<span class="lineNum">      98 </span>            :     // -zapwallettxes implies a rescan
<span class="lineNum">      99 </span><span class="lineCov">        417 :     if (zapwallettxes) {</span>
<span class="lineNum">     100 </span><span class="lineNoCov">          0 :         if (is_multiwallet) {</span>
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :             return InitError(strprintf(Untranslated(&quot;%s is only allowed with a single wallet file&quot;), &quot;-zapwallettxes&quot;));</span>
<span class="lineNum">     102 </span>            :         }
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :         if (gArgs.SoftSetBoolArg(&quot;-rescan&quot;, true)) {</span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :             LogPrintf(&quot;%s: parameter interaction: -zapwallettxes enabled -&gt; setting -rescan=1\n&quot;, __func__);</span>
<span class="lineNum">     105 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     106 </span>            :     }
<span class="lineNum">     107 </span>            : 
<span class="lineNum">     108 </span><span class="lineCov">        417 :     if (gArgs.GetBoolArg(&quot;-sysperms&quot;, false))</span>
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :         return InitError(Untranslated(&quot;-sysperms is not allowed in combination with enabled wallet functionality&quot;));</span>
<span class="lineNum">     110 </span>            : 
<span class="lineNum">     111 </span><span class="lineCov">        417 :     return true;</span>
<a name="112"><span class="lineNum">     112 </span><span class="lineCov">        417 : }</span></a>
<span class="lineNum">     113 </span>            : 
<a name="114"><span class="lineNum">     114 </span><span class="lineCov">        417 : void WalletInit::Construct(NodeContext&amp; node) const</span></a>
<span class="lineNum">     115 </span>            : {
<span class="lineNum">     116 </span><span class="lineCov">        834 :     ArgsManager&amp; args = *Assert(node.args);</span>
<span class="lineNum">     117 </span><span class="lineCov">        417 :     if (args.GetBoolArg(&quot;-disablewallet&quot;, DEFAULT_DISABLE_WALLET)) {</span>
<span class="lineNum">     118 </span><span class="lineNoCov">          0 :         LogPrintf(&quot;Wallet disabled!\n&quot;);</span>
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     120 </span>            :     }
<span class="lineNum">     121 </span><span class="lineCov">        417 :     args.SoftSetArg(&quot;-wallet&quot;, &quot;&quot;);</span>
<span class="lineNum">     122 </span><span class="lineCov">        417 :     node.chain_clients.emplace_back(interfaces::MakeWalletClient(*node.chain, args, args.GetArgs(&quot;-wallet&quot;)));</span>
<span class="lineNum">     123 </span><span class="lineCov">        417 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
